"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _logger = _interopRequireDefault(require("../../../common/logger"));

var _Garage = require("../../../common/models/Garage");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class GaragesService {
  async all() {
    _logger.default.info(`${this.constructor.name}.all()`);

    const result = await _Garage.Garage.find({}, (e, r) => r).catch(error => error);
    return result;
  }

  byId(id) {
    _logger.default.info(`${this.constructor.name}.byId(${id})`);

    return _Garage.Garage.findOne({
      _id: id
    }).catch(error => error);
  }

  async create(body) {
    _logger.default.info(`${this.constructor.name}.create()`);

    const garageConfig = {
      carsInLot: body.carsInLot || 0,
      capacity: body.capacity
    };
    const garage = await _Garage.Garage.create(garageConfig).catch(error => error);
    return garage;
  }

  async delete(id) {
    _logger.default.info(`delete ${this.constructor.name}.byId(${id})`);

    const result = await _Garage.Garage.deleteOne({
      _id: id
    }).catch(error => error);

    if (result instanceof Error) {
      return result;
    }

    const response = {
      message: `Garage with id ${id} and all associated data successfully removed!`,
      code: 'REMOVED'
    };
    return response;
  }

  async update(body) {
    _logger.default.info(`update ${this.constructor.name}.byId(${body._id})`);

    await _Garage.Garage.updateOne({
      _id: body._id
    }, body, {
      upsert: true
    }).catch(error => error);
    const garage = await _Garage.Garage.findOne({
      _id: body._id
    }).catch(error => error);

    if (garage) {
      garage.save();
      return garage;
    }

    return new Error("failed");
  }

}

var _default = new GaragesService();

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NlcnZlci9hcGkvc2VydmljZXMvZ2FyYWdlL2dhcmFnZXMuc2VydmljZS5qcyJdLCJuYW1lcyI6WyJHYXJhZ2VzU2VydmljZSIsImFsbCIsImwiLCJpbmZvIiwiY29uc3RydWN0b3IiLCJuYW1lIiwicmVzdWx0IiwiR2FyYWdlIiwiZmluZCIsImUiLCJyIiwiY2F0Y2giLCJlcnJvciIsImJ5SWQiLCJpZCIsImZpbmRPbmUiLCJfaWQiLCJjcmVhdGUiLCJib2R5IiwiZ2FyYWdlQ29uZmlnIiwiY2Fyc0luTG90IiwiY2FwYWNpdHkiLCJnYXJhZ2UiLCJkZWxldGUiLCJkZWxldGVPbmUiLCJFcnJvciIsInJlc3BvbnNlIiwibWVzc2FnZSIsImNvZGUiLCJ1cGRhdGUiLCJ1cGRhdGVPbmUiLCJ1cHNlcnQiLCJzYXZlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxjQUFOLENBQXFCO0FBQ2pCLFFBQU1DLEdBQU4sR0FBWTtBQUNSQyxvQkFBRUMsSUFBRixDQUFRLEdBQUUsS0FBS0MsV0FBTCxDQUFpQkMsSUFBSyxRQUFoQzs7QUFDQSxVQUFNQyxNQUFNLEdBQUcsTUFBTUMsZUFBT0MsSUFBUCxDQUFZLEVBQVosRUFBZ0IsQ0FBQ0MsQ0FBRCxFQUFJQyxDQUFKLEtBQVVBLENBQTFCLEVBQTZCQyxLQUE3QixDQUFtQ0MsS0FBSyxJQUFJQSxLQUE1QyxDQUFyQjtBQUNBLFdBQU9OLE1BQVA7QUFDSDs7QUFFRE8sRUFBQUEsSUFBSSxDQUFDQyxFQUFELEVBQUs7QUFDTFosb0JBQUVDLElBQUYsQ0FBUSxHQUFFLEtBQUtDLFdBQUwsQ0FBaUJDLElBQUssU0FBUVMsRUFBRyxHQUEzQzs7QUFDQSxXQUFPUCxlQUFPUSxPQUFQLENBQWU7QUFBRUMsTUFBQUEsR0FBRyxFQUFFRjtBQUFQLEtBQWYsRUFBNEJILEtBQTVCLENBQWtDQyxLQUFLLElBQUlBLEtBQTNDLENBQVA7QUFDSDs7QUFFRCxRQUFNSyxNQUFOLENBQWFDLElBQWIsRUFBbUI7QUFDZmhCLG9CQUFFQyxJQUFGLENBQVEsR0FBRSxLQUFLQyxXQUFMLENBQWlCQyxJQUFLLFdBQWhDOztBQUNBLFVBQU1jLFlBQVksR0FBRztBQUNqQkMsTUFBQUEsU0FBUyxFQUFFRixJQUFJLENBQUNFLFNBQUwsSUFBa0IsQ0FEWjtBQUVqQkMsTUFBQUEsUUFBUSxFQUFFSCxJQUFJLENBQUNHO0FBRkUsS0FBckI7QUFJQSxVQUFNQyxNQUFNLEdBQUcsTUFBTWYsZUFBT1UsTUFBUCxDQUFjRSxZQUFkLEVBQTRCUixLQUE1QixDQUFrQ0MsS0FBSyxJQUFJQSxLQUEzQyxDQUFyQjtBQUNBLFdBQU9VLE1BQVA7QUFDSDs7QUFFRCxRQUFNQyxNQUFOLENBQWFULEVBQWIsRUFBaUI7QUFDYlosb0JBQUVDLElBQUYsQ0FBUSxVQUFTLEtBQUtDLFdBQUwsQ0FBaUJDLElBQUssU0FBUVMsRUFBRyxHQUFsRDs7QUFDQSxVQUFNUixNQUFNLEdBQUcsTUFBTUMsZUFBT2lCLFNBQVAsQ0FBaUI7QUFBRVIsTUFBQUEsR0FBRyxFQUFFRjtBQUFQLEtBQWpCLEVBQThCSCxLQUE5QixDQUFvQ0MsS0FBSyxJQUFJQSxLQUE3QyxDQUFyQjs7QUFDQSxRQUFJTixNQUFNLFlBQVltQixLQUF0QixFQUE0QjtBQUN4QixhQUFPbkIsTUFBUDtBQUNIOztBQUNELFVBQU1vQixRQUFRLEdBQUc7QUFBRUMsTUFBQUEsT0FBTyxFQUFHLGtCQUFpQmIsRUFBRyxnREFBaEM7QUFBaUZjLE1BQUFBLElBQUksRUFBRTtBQUF2RixLQUFqQjtBQUNBLFdBQU9GLFFBQVA7QUFDSDs7QUFFRCxRQUFNRyxNQUFOLENBQWFYLElBQWIsRUFBbUI7QUFDZmhCLG9CQUFFQyxJQUFGLENBQVEsVUFBUyxLQUFLQyxXQUFMLENBQWlCQyxJQUFLLFNBQVFhLElBQUksQ0FBQ0YsR0FBSSxHQUF4RDs7QUFDQSxVQUFNVCxlQUFPdUIsU0FBUCxDQUFpQjtBQUFFZCxNQUFBQSxHQUFHLEVBQUVFLElBQUksQ0FBQ0Y7QUFBWixLQUFqQixFQUFvQ0UsSUFBcEMsRUFBMEM7QUFBRWEsTUFBQUEsTUFBTSxFQUFFO0FBQVYsS0FBMUMsRUFBNERwQixLQUE1RCxDQUFrRUMsS0FBSyxJQUFJQSxLQUEzRSxDQUFOO0FBQ0EsVUFBTVUsTUFBTSxHQUFHLE1BQU1mLGVBQU9RLE9BQVAsQ0FBZTtBQUFFQyxNQUFBQSxHQUFHLEVBQUVFLElBQUksQ0FBQ0Y7QUFBWixLQUFmLEVBQWtDTCxLQUFsQyxDQUF3Q0MsS0FBSyxJQUFJQSxLQUFqRCxDQUFyQjs7QUFDQSxRQUFHVSxNQUFILEVBQVc7QUFDUEEsTUFBQUEsTUFBTSxDQUFDVSxJQUFQO0FBQ0EsYUFBT1YsTUFBUDtBQUNIOztBQUNELFdBQU8sSUFBSUcsS0FBSixDQUFVLFFBQVYsQ0FBUDtBQUNIOztBQXpDZ0I7O2VBNENOLElBQUl6QixjQUFKLEUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbCBmcm9tICcuLi8uLi8uLi9jb21tb24vbG9nZ2VyJztcbmltcG9ydCB7IEdhcmFnZSB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9tb2RlbHMvR2FyYWdlJztcblxuY2xhc3MgR2FyYWdlc1NlcnZpY2Uge1xuICAgIGFzeW5jIGFsbCgpIHtcbiAgICAgICAgbC5pbmZvKGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0uYWxsKClgKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgR2FyYWdlLmZpbmQoe30sIChlLCByKSA9PiByKS5jYXRjaChlcnJvciA9PiBlcnJvcik7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgYnlJZChpZCkge1xuICAgICAgICBsLmluZm8oYCR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfS5ieUlkKCR7aWR9KWApO1xuICAgICAgICByZXR1cm4gR2FyYWdlLmZpbmRPbmUoeyBfaWQ6IGlkIH0pLmNhdGNoKGVycm9yID0+IGVycm9yKTtcbiAgICB9XG5cbiAgICBhc3luYyBjcmVhdGUoYm9keSkge1xuICAgICAgICBsLmluZm8oYCR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfS5jcmVhdGUoKWApO1xuICAgICAgICBjb25zdCBnYXJhZ2VDb25maWcgPSB7XG4gICAgICAgICAgICBjYXJzSW5Mb3Q6IGJvZHkuY2Fyc0luTG90IHx8IDAsXG4gICAgICAgICAgICBjYXBhY2l0eTogYm9keS5jYXBhY2l0eVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBnYXJhZ2UgPSBhd2FpdCBHYXJhZ2UuY3JlYXRlKGdhcmFnZUNvbmZpZykuY2F0Y2goZXJyb3IgPT4gZXJyb3IpO1xuICAgICAgICByZXR1cm4gZ2FyYWdlO1xuICAgIH1cblxuICAgIGFzeW5jIGRlbGV0ZShpZCkge1xuICAgICAgICBsLmluZm8oYGRlbGV0ZSAke3RoaXMuY29uc3RydWN0b3IubmFtZX0uYnlJZCgke2lkfSlgKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgR2FyYWdlLmRlbGV0ZU9uZSh7IF9pZDogaWQgfSkuY2F0Y2goZXJyb3IgPT4gZXJyb3IpO1xuICAgICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgRXJyb3Ipe1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHsgbWVzc2FnZTogYEdhcmFnZSB3aXRoIGlkICR7aWR9IGFuZCBhbGwgYXNzb2NpYXRlZCBkYXRhIHN1Y2Nlc3NmdWxseSByZW1vdmVkIWAsIGNvZGU6ICdSRU1PVkVEJyB9O1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxuXG4gICAgYXN5bmMgdXBkYXRlKGJvZHkpIHtcbiAgICAgICAgbC5pbmZvKGB1cGRhdGUgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9LmJ5SWQoJHtib2R5Ll9pZH0pYCk7XG4gICAgICAgIGF3YWl0IEdhcmFnZS51cGRhdGVPbmUoeyBfaWQ6IGJvZHkuX2lkIH0sIGJvZHksIHsgdXBzZXJ0OiB0cnVlIH0pLmNhdGNoKGVycm9yID0+IGVycm9yKTtcbiAgICAgICAgY29uc3QgZ2FyYWdlID0gYXdhaXQgR2FyYWdlLmZpbmRPbmUoeyBfaWQ6IGJvZHkuX2lkIH0pLmNhdGNoKGVycm9yID0+IGVycm9yKTtcbiAgICAgICAgaWYoZ2FyYWdlKSB7XG4gICAgICAgICAgICBnYXJhZ2Uuc2F2ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGdhcmFnZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IEVycm9yKFwiZmFpbGVkXCIpO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgbmV3IEdhcmFnZXNTZXJ2aWNlKCk7XG4iXX0=